# WinSentinel v1.2.0 - AI-Powered Windows Forensic Analysis Platform

## Overview

WinSentinel is a next-generation forensic analysis tool designed to combat modern Windows-based threats. Using artificial intelligence, it live-scrapes system artifacts, correlates multiple parameters (Registry, Network, Process Trees), and generates a high-fidelity "Infection Timeline" to distinguish malicious activity from benign behavior.

**Key Features:**
- ✅ **Live System Scraping** - Real-time collection of processes, registry, network, and event logs
- ✅ **AI-Powered Anomaly Detection** - Unsupervised learning identifies suspicious patterns
- ✅ **Sequence Analysis** - Detects multi-step attack patterns using temporal correlation
- ✅ **Infection Timeline** - Builds the "Golden Thread" showing attack progression
- ✅ **Forensic Integrity** - SHA-256 hashing and Chain of Custody logging
- ✅ **Court-Ready Exports** - CSV, Excel, PDF, JSON with metadata and XAI reasoning
- ✅ **MITRE ATT&CK Mapping** - Tactical framework alignment for incident response
- ✅ **React Dashboard** - Intuitive UI with real-time visualization

---

## Project Structure

```
foren/
├── backend/                          # Python FastAPI server
│   ├── main.py                       # Main API server
│   ├── config.py                     # Configuration
│   ├── requirements.txt              # Python dependencies
│   ├── scrapers/                     # Windows data collection
│   │   ├── process_scraper.py        # Process tree extraction
│   │   ├── registry_scraper.py       # Registry persistence detection
│   │   ├── network_scraper.py        # Active connection monitoring
│   │   └── event_log_scraper.py      # Security event log parsing
│   ├── ai_engine/                    # ML/AI models
│   │   ├── anomaly_detector.py       # Isolation Forest for outliers
│   │   └── sequence_analyzer.py      # LSTM-style sequence detection
│   ├── data_normalization/           # Schema unification
│   │   └── normalizer.py             # Log format normalization
│   ├── database/                     # TimescaleDB client
│   │   └── db_client.py              # PostgreSQL + TimescaleDB
│   ├── exporters/                    # Forensic export engine
│   │   └── export_manager.py         # Court-ready reports
│   └── models/                       # Pre-trained ML models (future)
│
├── frontend/                         # React.js dashboard
│   ├── package.json                  # NPM dependencies
│   ├── vite.config.js                # Vite bundler config
│   ├── tailwind.config.js            # Tailwind CSS
│   ├── postcss.config.js             # PostCSS
│   ├── index.html                    # HTML entry point
│   └── src/
│       ├── main.jsx                  # React entry point
│       ├── App.jsx                   # Main app component
│       ├── index.css                 # Global styles
│       └── pages/
│           ├── Page1LiveScraping.jsx         # Page 1: Live Scraping
│           ├── Page2DatasetManagement.jsx    # Page 2: Dataset Upload/Normalize
│           └── Page3AIForensicEngine.jsx     # Page 3: AI Analysis & Timeline
│
└── README.md                         # This file
```

---

## Installation & Setup

### Prerequisites

- **Windows 10/11** (for live scraping features)
- **Python 3.11+** (for backend)
- **Node.js 18+** (for frontend)
- **Administrator privileges** (for registry and event log access)
- **PostgreSQL 14+** (optional, for production database)

### Step 1: Backend Setup

```bash
# Navigate to backend directory
cd backend

# Create virtual environment
python -m venv venv
venv\Scripts\activate

# Install Python dependencies
pip install -r requirements.txt

# (Optional) Install Windows-specific packages for live scraping
pip install pywin32
# Run post-install script
python Scripts/pywin_postinstall.py -install
```

### Step 2: Frontend Setup

```bash
# Navigate to frontend directory
cd ../frontend

# Install Node dependencies
npm install

# (Optional) Install Tailwind CSS dependencies
npm install -D tailwindcss postcss autoprefixer
npx tailwindcss init -p
```

### Step 3: Database Setup (Optional - for production)

```sql
-- Install TimescaleDB extension on PostgreSQL
CREATE EXTENSION IF NOT EXISTS timescaledb;

-- Schema is auto-generated by db_client.py on first run
```

---

## Running WinSentinel

### Option A: Local Development

**Terminal 1 - Backend API:**
```bash
cd backend
python main.py
# API runs on http://localhost:8000
```

**Terminal 2 - Frontend Dashboard:**
```bash
cd frontend
npm run dev
# Dashboard runs on http://localhost:3000
```

### Option B: Using Vite & Uvicorn

```bash
# Backend (from backend/ directory)
uvicorn main:app --reload --host 0.0.0.0 --port 8000

# Frontend (from frontend/ directory)
npm run dev
```

### Option C: Production Deployment

```bash
# Backend
pip install gunicorn
gunicorn main:app --workers 4 --bind 0.0.0.0:8000

# Frontend
npm run build
# Serve dist/ folder with nginx or other web server
```

---

## API Endpoints

### Health Check
```
GET /health
```

### Page 1: Live Scraping
```
POST /api/scrape/start
{
  "scope": "full_system|volatile_only|custom",
  "include_processes": true,
  "include_registry": true,
  "include_network": true,
  "include_event_logs": true,
  "custom_registry_keys": ["HKLM\\Software\\..."]
}

GET /api/scrape/system-telemetry
GET /api/scrape/integrity-check
```

### Page 2: Dataset Management
```
POST /api/dataset/upload (multipart/form-data)

POST /api/dataset/normalize
{
  "dataset_name": "UNSW-NB15.csv",
  "dataset_type": "csv",
  "timestamp_column": "Stime",
  "source_ip_column": "srcip"
}

GET /api/dataset/list
POST /api/dataset/deduplicate
```

### Page 3: AI Forensic Engine
```
POST /api/analysis/run?dataset_name=UNSW-NB15.csv

GET /api/analysis/timeline?dataset_name=UNSW-NB15.csv

GET /api/analysis/risk-gauge?dataset_name=UNSW-NB15.csv

GET /api/analysis/xai-explanation?event_id=123

GET /api/analysis/parameter-breakdown?dataset_name=UNSW-NB15.csv
```

### Export & Chain of Custody
```
POST /api/export/forensic-report
{
  "case_id": "CASE_2026_001",
  "investigator_name": "John Doe",
  "export_format": "csv|excel|pdf|json",
  "export_type": "snapshot|difference_report|timeline"
}

GET /api/export/chain-of-custody
```

---

## Key Features Explained

### 1. Live Scraping (Page 1)
- **Process Monitor**: Extracts parent/child process trees to detect suspicious spawning
- **Registry Watcher**: Monitors `HKLM\...\CurrentVersion\Run` for persistence mechanisms
- **Network Sniffer**: Lists active TCP/UDP connections with remote IPs
- **Integrity Check**: SHA-256 hashes every data chunk for forensic integrity
- **System Telemetry**: Real-time CPU/RAM monitoring to prevent system overload

### 2. Dataset Management (Page 2)
- **Upload Portal**: Drag-and-drop support for CSV, JSON, EVTX, XLSX files
- **Schema Normalizer**: Maps diverse log formats to unified schema:
  ```python
  ['timestamp', 'event_type', 'source_ip', 'destination_ip', 'protocol', 
   'process_name', 'user', 'action', 'risk_score']
  ```
- **Noise Reduction**: Filters known benign Windows chatter
- **Deduplication**: Removes redundant entries to improve AI performance
- **Archive**: Maintains history of previous datasets for comparison

### 3. AI Forensic Engine (Page 3)
- **Anomaly Detection** (Isolation Forest):
  - Unsupervised learning on network parameters
  - No need for labeled "malicious" data
  - Identifies "doesn't look right" events
  
- **Sequence Analysis**:
  - Detects multi-step attack patterns
  - Example: `[Process Spawn] → [Registry Modification] → [Network Connection]`
  - Maps to MITRE ATT&CK tactics
  
- **Risk Scoring**: 0-100% infection probability gauge
  
- **XAI (Explainable AI)**: Natural language reasoning for each alert
  - "Flagged because powershell.exe modified HKLM\...\Run while on port 4444"
  - MITRE technique mapping (e.g., T1547.001)

- **Golden Thread Timeline**: Chronological visualization of attack progression
  - Color-coded: Green (benign), Yellow (suspicious), Red (malicious)

### 4. Forensic Export
- **Court-Ready Metadata**:
  - Case ID, Investigator Name, Timestamp
  - Tool version (WinSentinel v1.2.0)
  - Library versions (PyTorch, Pandas, etc.)
  
- **Integrity Seal**: SHA-256 hash prevents tampering
  
- **Chain of Custody Log**: Immutable record of all exports with recipients
  
- **Export Formats**:
  - **CSV**: Tabular data for Excel/Sheets
  - **Excel**: Multi-sheet workbook with metadata
  - **PDF**: Visual timeline + risk charts
  - **JSON**: API consumption + integration

---

## AI Models Explained

### Anomaly Detection (Isolation Forest)
```python
from sklearn.ensemble import IsolationForest

# Trained on UNSW-NB15 or CICIDS2017 network flows
# Features: Duration, Bytes Sent/Received, TTL, Jitter, etc.
# Output: Risk score 0.0-1.0

model = IsolationForest(contamination=0.1)  # Expect ~10% anomalies
predictions = model.fit_predict(X)          # -1 = anomaly, 1 = normal
```

### Sequence Analysis
```python
# Matches attack sequences to MITRE ATT&CK:
SEQUENCES = {
  'persistence_run_key': ['Process Spawn', 'Registry Modification', 'System Restart']  # T1547.001
  'fileless_malware': ['PowerShell Execution', 'Script Block', 'Network Connection']    # T1059.001
  'lateral_movement': ['Logon Activity', 'Process Creation', 'Network Connection']      # T1021
}
```

---

## Supported Datasets

WinSentinel is optimized for these public datasets:

1. **UNSW-NB15**
   - 49 features (Basic + Content + Time + Generated)
   - 2.5M flows from Australian Defense Academy
   - Download: https://www.unsw.adfa.edu.au/unsw-canberra-cyber/cybersecurity/UNSW-NB15-Datasets/

2. **CICIDS2017**
   - Network IDS dataset from Canadian Institu of Cybersecurity
   - 80 features, labeled attacks (Brute Force, DDoS, etc.)
   - Download: https://www.kaggle.com/datasets/cicdataset/cicids2017

3. **Windows Event Logs** (.evtx)
   - Direct import via python-evtx library
   - Focuses on Event IDs: 4688, 4624, 4104, 1102

---

## Configuration

Edit `backend/config.py` to customize:

```python
# AI Model Parameters
ANOMALY_DETECTION = {
    "algorithm": "isolation_forest",
    "contamination": 0.1,  # 10% of data expected to be anomalies
    "n_estimators": 100
}

# Risk Thresholds
RISK_THRESHOLDS = {
    "critical": 0.85,
    "high": 0.65,
    "medium": 0.45,
    "low": 0.25
}

# Database Connection
DATABASE_CONFIG = {
    "host": "localhost",
    "port": 5432,
    "database": "winssentinel"
}
```

---

## Troubleshooting

### Issue: "Backend API not available"
```bash
# Check if FastAPI is running
netstat -ano | findstr :8000

# Restart backend
cd backend && python main.py
```

### Issue: "Admin privileges required"
```bash
# Launch PowerShell as Administrator, then:
cd <path-to-project>
python backend/main.py
```

### Issue: "Registry access denied"
```python
# Edit registry_scraper.py to handle PermissionError gracefully
# Some keys require admin or SYSTEM privileges
```

### Issue: "Pandas import error"
```bash
# Reinstall pandas
pip uninstall pandas scikit-learn
pip install pandas==2.0.0 scikit-learn==1.3.0
```

---

## Performance Optimization

### For Large Datasets (>1M rows):
1. **Enable Noise Reduction** to filter benign traffic
2. **Deduplicate** to reduce row count
3. **Use TimescaleDB** for indexing and compression
4. **Batch Process** with `chunksize=10000`

### AI Model Tuning:
```python
# Increase detection sensitivity
ANOMALY_DETECTION["contamination"] = 0.05  # 5% anomalies

# Decrease sequence match threshold for more detections
SEQUENCE_ANALYSIS["match_threshold"] = 0.5  # 50% instead of 70%
```

---

## Security Considerations

⚠️ **Production Deployment Checklist:**
- [ ] Use environment variables for database credentials (not hardcoded)
- [ ] Enable HTTPS/TLS for API communication
- [ ] Implement authentication (JWT tokens)
- [ ] Restrict CORS origins to trusted domains
- [ ] Store exported files in encrypted storage
- [ ] Audit all Chain of Custody exports
- [ ] Run backend with least-privilege account
- [ ] Validate all user inputs (SQL injection prevention)

---

## Contributing

To extend WinSentinel:

1. **Add New Scraper**: Implement in `backend/scrapers/`
2. **Add New AI Model**: Extend `backend/ai_engine/`
3. **Add New Export Format**: Extend `backend/exporters/export_manager.py`
4. **Add Frontend Component**: Add `.jsx` file in `frontend/src/pages/`

---

## References

- **MITRE ATT&CK Framework**: https://attack.mitre.org/
- **Windows Forensics**: https://www.sans.org/white-papers/
- **Scikit-Learn Anomaly Detection**: https://scikit-learn.org/stable/modules/outlier_detection.html
- **FastAPI Documentation**: https://fastapi.tiangolo.com/
- **React Documentation**: https://react.dev/

---

## License

WinSentinel v1.2.0 © 2026. For forensic and incident response professionals.

---

## Support

For issues, questions, or feature requests, contact the development team.

**Status**: ✅ Production Ready | Last Updated: 2026-01-31
